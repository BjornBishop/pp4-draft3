{% extends 'base.html' %}

{% block content %}
<style>
    .assignment-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .assignment-header {
        margin-bottom: 2rem;
    }

    .assignment-detail {
        margin-bottom: 1rem;
    }

    .detail-label {
        font-weight: bold;
        color: #666;
    }

    .back-button {
        display: inline-block;
        margin-top: 2rem;
        text-decoration: none;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
        background-color: white;
        margin: 15% auto;
        padding: 20px;
        width: 80%;
        max-width: 500px;
        border-radius: 5px;
        position: relative;
    }

    .close {
        position: absolute;
        right: 10px;
        top: 5px;
        font-size: 24px;
        cursor: pointer;
    }

    .datetime-picker {
        margin-bottom: 1rem;
    }
    .time-slots {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
        margin: 15px 0;
    }
    .time-slot {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
    }

    .time-slot:hover {
        background-color: #f0f0f0;
    }

    .time-slot.selected {
        background-color: #007bff;
        color: white;
        border-color: #0056b3;
    }

    .time-slot.disabled {
        background-color: #f5f5f5;
        color: #999;
        cursor: not-allowed;
    }
    .time-section {
        margin: 20px 0;
    }

    .time-section h4 {
        margin-bottom: 10px;
        color: #333;
    }

    .meeting-note {
        background-color: #f8f9fa;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 20px;
        font-size: 0.9em;
        color: #666;
    }

    .timezone-info {
        color: #666;
        margin-bottom: 1rem;
        font-size: 0.9em;
    }
</style>

<div class="assignment-container">
    <div class="assignment-header">
        <h1>{{ assignment.title }}</h1>
    </div>

    <div class="assignment-detail">
        <div class="detail-label">Industry</div>
        <div>{{ assignment.get_industry_display }}</div>
    </div>

    <div class="assignment-detail">
        <div class="detail-label">Duration</div>
        <div>{{ assignment.duration }} days</div>
    </div>

    <div class="assignment-detail">
        <div class="detail-label">Rate</div>
        <div>${{ assignment.rate }}/day</div>
    </div>

    <div class="assignment-detail">
        <div class="detail-label">Requirements</div>
        <div>{{ assignment.requirements }}</div>
    </div>

    <div class="assignment-detail">
        <div class="detail-label">Description</div>
        <div>{{ assignment.description }}</div>
    </div>

    <a href="{% url 'dashboard' %}" class="back-button">
        <button>Back to Dashboard</button>
    </a>
    {% if request.user != assignment.creator %}
        <button onclick="openMeetingModal()" class="request-meeting-btn">Request Meeting</button>
    {% endif %}
</div>

<!-- Meeting Request Modal -->
<div id="meetingModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeMeetingModal()">&times;</span>
        <h2>Request Meeting with Site Admin</h2>
        
        <div class="meeting-note">
            <p>üìå All meetings are scheduled with the site administrator.</p>
            <p>‚è∞ Time zone: UTC+1 (London)</p>
            <p>üìÖ Available on weekdays only</p>
        </div>

        <form method="post" action="{% url 'request_meeting' assignment.id %}" id="meetingForm">
            {% csrf_token %}
            <div class="form-group">
                <label for="preferred_date">Select Date:</label>
                <input type="date" id="preferred_date" name="preferred_date" required
                       onchange="updateAvailableTimeSlots()">
            </div>

            <div class="time-section">
                <h4>Morning Slots (10:00 - 11:30)</h4>
                <div class="time-slots" id="morningSlots"></div>
                
                <h4>Afternoon Slots (13:00 - 17:00)</h4>
                <div class="time-slots" id="afternoonSlots"></div>
            </div>

            <input type="hidden" id="preferred_time" name="preferred_time">
            
            <div class="form-group">
                <label for="message">Message (optional):</label>
                <textarea id="message" name="message" rows="4" 
                          placeholder="Add any specific topics you'd like to discuss..."></textarea>
            </div>

            <button type="submit" id="submitButton" disabled>Request Meeting</button>
        </form>
    </div>
</div>

<script>
const timeSlots = {
    morning: [
        '10:00', '10:30', '11:00', '11:30'
    ],
    afternoon: [
        '13:00', '13:30', '14:00', '14:30', 
        '15:00', '15:30', '16:00', '16:30'
    ]
};

function createTimeSlots() {
    const morningContainer = document.getElementById('morningSlots');
    const afternoonContainer = document.getElementById('afternoonSlots');
    
    morningContainer.innerHTML = '';
    afternoonContainer.innerHTML = '';
    
    timeSlots.morning.forEach(time => {
        const slot = document.createElement('div');
        slot.className = 'time-slot';
        slot.textContent = time;
        slot.onclick = () => selectTimeSlot(slot);
        morningContainer.appendChild(slot);
    });
    
    timeSlots.afternoon.forEach(time => {
        const slot = document.createElement('div');
        slot.className = 'time-slot';
        slot.textContent = time;
        slot.onclick = () => selectTimeSlot(slot);
        afternoonContainer.appendChild(slot);
    });
}

function selectTimeSlot(element) {
    // Clear previous selection
    document.querySelectorAll('.time-slot').forEach(slot => {
        slot.classList.remove('selected');
    });
    
    // Select new slot
    element.classList.add('selected');
    document.getElementById('preferred_time').value = element.textContent;
    document.getElementById('submitButton').disabled = false;
}

function updateAvailableTimeSlots() {
    const dateInput = document.getElementById('preferred_date');
    const selectedDate = new Date(dateInput.value);
    
    // Disable weekends
    if (selectedDate.getDay() === 0 || selectedDate.getDay() === 6) {
        alert('Weekend dates are not available for meetings. Please select a weekday.');
        dateInput.value = '';
        document.getElementById('submitButton').disabled = true;
        return;
    }
    
    createTimeSlots();
}

function openMeetingModal() {
    document.getElementById('meetingModal').style.display = 'block';
    // Set min date to today
    const dateInput = document.getElementById('preferred_date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.min = today;
    dateInput.value = today;
    updateAvailableTimeSlots();
}

function closeMeetingModal() {
    document.getElementById('meetingModal').style.display = 'none';
}

window.onclick = function(event) {
    const modal = document.getElementById('meetingModal');
    if (event.target == modal) {
        closeMeetingModal();
    }
}

// Initialize time slots when the modal opens
document.addEventListener('DOMContentLoaded', createTimeSlots);
</script>
{% endblock %}